<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TRF Consent Form</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css"/>
  <style>
    .error-msg {
      color: red;
      font-size: 0.875em;
      display: none;
    }
    .form-control.error {
      border-color: red;
    }
    .iti {
      width: 100%;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="form-header d-flex justify-content-between align-items-center mb-4">
    <img src="/static/Images/gutgenics_logo.png" alt="Left Logo" class="logo-img">
    <h2 class="text-center flex-grow-1">TRF Consent Form</h2>
    <img src="/static/Images/progenics_logo.jpg" alt="Right Logo" class="logo-img">
  </div>

  <form id="consentForm">
    <div class="form-group">
      <label>Full Name:</label>
      <input type="text" name="full_name" class="form-control" required>
    </div>

    <div class="form-group">
      <label>Gender:</label><br>
      <input type="radio" name="gender" value="Male" required> Male
      <input type="radio" name="gender" value="Female" required> Female
      <input type="radio" name="gender" value="Other"> Other
    </div>

    <div class="form-group">
      <label>Date of Birth:</label>
      <input type="date" name="dob" class="form-control" required>
    </div>

    <div class="form-group">
      <label>Email:</label>
      <input type="email" name="email" class="form-control" required>
    </div>

    <!-- International Phone Input -->
    <div class="form-group">
      <label for="contact">Contact Number:</label>
      <input id="contact" name="contact" type="tel" class="form-control" required>
      <div id="phoneError" class="error-msg">Please enter a valid phone number.</div>
    </div>

    <div class="form-group">
      <label>Address:</label>
      <textarea name="address" class="form-control" rows="3" required></textarea>
    </div>

    <div class="form-group">
      <label>Test Requested:</label><br>
      <input type="checkbox" name="test_requested" value="Standard"> Standard
      <input type="checkbox" name="test_requested" value="Prime"> Prime
      <input type="checkbox" name="test_requested" value="Elite"> Elite
    </div>

    <div class="form-group">
      <label>Sample Type:</label><br>
      <input type="checkbox" name="sample_type" value="Stool"> Stool
      <input type="checkbox" name="sample_type" value="Biopsy"> Biopsy
      <input type="checkbox" name="sample_type" value="Other"> Other
    </div>

    <div class="form-group">
      <label>Height (cm):</label>
      <input type="number" name="height" class="form-control">
    </div>

    <div class="form-group">
      <label>Weight (kg):</label>
      <input type="number" name="weight" class="form-control">
    </div>

    <div class="form-group">
      <label>Sampling Date:</label>
      <input type="date" name="sampling_date" class="form-control">
    </div>

    <div class="form-group">
      <label>Sampling Time:</label>
      <input type="time" name="sampling_time" class="form-control">
    </div>

    <div class="form-group">
      <label>Primary reason for ordering this test:</label><br>
      <input type="checkbox" name="reason" value="IBD"> IBD
      <input type="checkbox" name="reason" value="IBS"> IBS
      <input type="checkbox" name="reason" value="Constipation"> Constipation
      <input type="checkbox" name="reason" value="Bloating"> Bloating
      <input type="checkbox" name="reason" value="GERD"> GERD
      <input type="checkbox" name="reason" value="Other"> Other (specify below)
    </div>

    <div class="form-group">
      <label>If other, please specify:</label>
      <input type="text" name="reason_other" class="form-control">
    </div>

    <h3 class="section-heading">Lifestyle Details</h3>

    <div class="form-group">
      <label>Are you using any medications?</label><br>
      <input type="radio" name="medications" value="Yes" id="medYes"> Yes
      <input type="radio" name="medications" value="No" id="medNo"> No
    </div>

    <div class="form-group" id="medDetails" style="display: none;">
      <label>If yes, specify:</label>
      <textarea name="medication_details" class="form-control" rows="2"></textarea>
    </div>

    <div class="form-group">
      <label>Have you been diagnosed with any disease?</label><br>
      <input type="radio" name="disease" value="Yes" id="diseaseYes"> Yes
      <input type="radio" name="disease" value="No" id="diseaseNo"> No
    </div>

    <div class="form-group" id="diseaseDetails" style="display: none;">
      <label>If yes, specify:</label>
      <textarea name="disease_details" class="form-control" rows="2"></textarea>
    </div>

    <div class="form-group">
      <label>Which of the following do you eat?</label><br>
      <input type="checkbox" name="diet" value="Veg"> Veg
      <input type="checkbox" name="diet" value="Non-Veg"> Non-Veg
    </div>

    <div class="form-group">
      <label>Exercise:</label><br>
      <input type="checkbox" name="exercise" value="Sedentary"> Sedentary
      <input type="checkbox" name="exercise" value="Mild"> Mild exercise
      <input type="checkbox" name="exercise" value="Vigorous"> Vigorous exercise
    </div>

    <div class="form-group">
      <label>Tobacco/Nicotine Usage:</label><br>
      <input type="radio" name="tobacco" value="Yes" id="tobaccoYes"> Yes
      <input type="radio" name="tobacco" value="No" id="tobaccoNo"> No
    </div>

    <div class="form-group" id="tobaccoDetails" style="display: none;">
      <label>If yes, number of cigarettes per week:</label>
      <input type="text" name="cigarettes_per_week" class="form-control">
    </div>

    <div class="form-group">
      <label>Alcohol Consumption:</label><br>
      <input type="radio" name="alcohol" value="Yes" id="alcoholYes"> Yes
      <input type="radio" name="alcohol" value="No" id="alcoholNo"> No
      <input type="radio" name="alcohol" value="Occasionally" id="alcoholOccasionally"> Occasionally
    </div>

    <div id="alcoholDetails" style="display: none;">
      <div class="form-group">
        <label>If yes, number of days per week:</label>
        <input type="text" name="alcohol_days_per_week" class="form-control">
      </div>

      <div class="form-group">
        <label>Alcohol Quantity (ml/week):</label>
        <input type="text" name="alcohol_quantity" class="form-control">
      </div>
    </div>

    <div class="form-group">
      <label>Nationality/Ethnicity:</label><br>
      <input type="checkbox" id="ethnicityAsian" name="ethnicity" value="Asian"> Asian (Indian, Pakistan, Bangladesh, Sri Lanka, Nepal)
      <input type="checkbox" id="ethnicityNo" name="ethnicity" value="No"> No
    </div>

    <div class="form-group" id="ethnicityOtherDiv">
      <label>If not Asian, please specify:</label>
      <input type="text" id="ethnicityOther" name="ethnicity_other" class="form-control">
    </div>

    <div class="form-group">
      <label>Native Place:</label>
      <input type="text" name="native_place" class="form-control">
    </div>

    <div class="form-group">
      <label>Mother Tongue:</label>
      <input type="text" name="mother_tongue" class="form-control">
    </div>

    <h3 class="section-heading">Informed Consent for Gut Health Testing</h3>
<p>
    I voluntarily consent to submit my sample(s) for gut health testing. I understand that the sample I provided will be analyzed to provide insights into known diseases, traits, drug responses, etc.<br><br>

    I recognize that the results will primarily indicate my risk or predisposition for specific diseases, traits, or responses to medications. The test results are not intended for diagnostic purposes; rather, they serve as predictive screening for preventive healthcare.<br><br>

    I have been informed about the clinical significance and implications of the tests, the services offered, the methodologies employed, and their limitations. I have had the chance to ask questions before signing this document, and I have been assured that any inquiries regarding the tests will be addressed by the Progenics support team and staff.<br><br>

    The specimen, clinical information, and data in a de-identified manner may be used for research, educational studies, and/or publication when appropriate. Rest assured, your name and any personal identifying details will not be associated with the results of any studies or publications.<br><br>

    For customers who consent to this, their samples may be reused, retested, and reanalyzed to create data for research and/or to develop new products.<br><br>

    For more information, please visit <a href="https://www.progenicslabs.com" target="_blank">www.progenicslabs.com</a>.
</p>

    <!-- Consent Checkbox -->
    <div class="form-group">
      <input type="checkbox" id="consentCheckbox"> I agree to the above consent.
    </div>

    <!-- Signature Pad & Submit Button -->
    <div id="signatureSection" style="display: none;">
      <div class="form-group">
        <label>Signature (Draw Below):</label>
        <canvas id="signature-pad" width="500" height="150" style="border: 1px solid black;"></canvas>
      </div>
      <button type="button" class="btn clear-btn" id="clear-signature">Clear</button>
      <button type="submit" class="btn" id="submitBtn">Submit</button>
    </div>
  </form>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>
<!-- <script src="script.js"></script> -->

<script>
  const contactInput = document.querySelector("#contact");
  const phoneError = document.querySelector("#phoneError");

  const iti = window.intlTelInput(contactInput, {
    initialCountry: "auto",
    separateDialCode: true,
    nationalMode: false,
    geoIpLookup: function(callback) {
      fetch("https://ipapi.co/json")
        .then(res => res.json())
        .then(data => callback(data.country_code))
        .catch(() => callback("IN"));
    },
    utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"
  });

  document.getElementById("consentForm").addEventListener("submit", function(e) {
    if (!iti.isValidNumber()) {
      e.preventDefault();
      contactInput.classList.add("error");
      phoneError.style.display = "block";
    } else {
      contactInput.classList.remove("error");
      phoneError.style.display = "none";
      contactInput.value = iti.getNumber();
    }
  });

  // Toggle visibility for conditional fields
  $('#medYes').on('click', () => $('#medDetails').show());
  $('#medNo').on('click', () => $('#medDetails').hide());

  $('#diseaseYes').on('click', () => $('#diseaseDetails').show());
  $('#diseaseNo').on('click', () => $('#diseaseDetails').hide());

  $('#tobaccoYes').on('click', () => $('#tobaccoDetails').show());
  $('#tobaccoNo').on('click', () => $('#tobaccoDetails').hide());

  $('#alcoholYes, #alcoholOccasionally').on('click', () => $('#alcoholDetails').show());
  $('#alcoholNo').on('click', () => $('#alcoholDetails').hide());

  $('#consentCheckbox').on('change', function () {
    $('#signatureSection').toggle(this.checked);
  });

</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("consentForm");
    const canvas = document.getElementById("signature-pad");
    const signaturePad = new SignaturePad(canvas);
    const signatureSection = document.getElementById("signatureSection");

    // --- Signature logic ---
    document.getElementById("consentCheckbox").addEventListener("change", function () {
        signatureSection.style.display = this.checked ? "block" : "none";
        if (!this.checked) signaturePad.clear();
    });

    document.getElementById("clear-signature").addEventListener("click", () => {
        signaturePad.clear();
    });

    // --- Submit handler ---
    form.addEventListener("submit", function (event) {
        event.preventDefault();

        if (signaturePad.isEmpty()) {
            alert("Please provide your signature before submitting.");
            return;
        }

        const formData = new FormData(this);
        const signatureData = signaturePad.toDataURL();
        formData.append("signature_data", signatureData);

        fetch("/submit", {
            method: "POST",
            body: formData
        })
        .then(() => alert("Form submitted successfully!"))
        .catch(err => {
            console.error(err);
            alert("Something went wrong. Please try again.");
        });
    });

    // --- Toggle helpers ---
    function toggleSection(yesId, noId, targetId, inputSelector) {
        const yes = document.getElementById(yesId);
        const no = document.getElementById(noId);
        const target = document.getElementById(targetId);
        const input = target.querySelector(inputSelector);

        const toggle = () => {
            if (yes.checked) {
                target.style.display = "block";
                input.setAttribute("required", "true");
            } else {
                target.style.display = "none";
                input.removeAttribute("required");
                const err = target.querySelector(".error-msg");
                if (err) err.textContent = "";
            }
        };

        yes?.addEventListener("change", toggle);
        no?.addEventListener("change", toggle);
        input?.addEventListener("input", () => {
            showError(input, input.value.trim() !== "", "This field is required.");
        });

        toggle();
    }

    toggleSection("medYes", "medNo", "medDetails", "textarea");
    toggleSection("diseaseYes", "diseaseNo", "diseaseDetails", "textarea");
    toggleSection("tobaccoYes", "tobaccoNo", "tobaccoDetails", "input");
    toggleSection("alcoholYes", "alcoholNo", "alcoholDetails", "input");

    // Alcohol Occasionally also triggers details
    ["alcoholYes", "alcoholOccasionally"].forEach(id => {
        const radio = document.getElementById(id);
        radio?.addEventListener("change", () => {
            document.getElementById("alcoholDetails").style.display = "block";
        });
    });
    document.getElementById("alcoholNo")?.addEventListener("change", () => {
        document.getElementById("alcoholDetails").style.display = "none";
    });

    // Ethnicity - Show "Other" field
    document.getElementById("ethnicityAsian")?.addEventListener("change", () => {
        document.getElementById("ethnicityOtherDiv").style.display = "none";
    });
    document.getElementById("ethnicityNo")?.addEventListener("change", () => {
        document.getElementById("ethnicityOtherDiv").style.display = "block";
    });

    // Checkbox group validation
    const checkboxGroups = ["test_requested", "sample_type", "diet", "exercise", "ethnicity"];
    checkboxGroups.forEach(name => {
        const boxes = [...form.querySelectorAll(`input[name="${name}"]`)];
        boxes.forEach(box =>
            box.addEventListener("change", () => validateCheckboxGroup(name, "Please select at least one option."))
        );
    });

    function validateCheckboxGroup(name, message) {
        const boxes = [...form.querySelectorAll(`input[name="${name}"]`)];
        const group = boxes[0].closest(".form-group");
        const anyChecked = boxes.some(cb => cb.checked);
        let errorEl = group.querySelector(".error-msg");
        if (!errorEl) {
            errorEl = document.createElement("div");
            errorEl.className = "error-msg";
            errorEl.style.color = "red";
            group.appendChild(errorEl);
        }
        errorEl.textContent = anyChecked ? "" : message;
    }

    // Input validations
    const validationMessages = {
        full_name: "Please enter your full name.",
        dob: "Please enter your date of birth.",
        email: "Please enter a valid email address.",
        contact: "Please enter your contact number.",
        address: "Please enter your address.",
        native_place: "Please enter your native place.",
        mother_tongue: "Please enter your mother tongue."
    };

    Object.keys(validationMessages).forEach(name => {
        const input = form.querySelector(`[name="${name}"]`);
        if (input) {
            input.addEventListener("input", () => {
                const message = validationMessages[name];
                const valid = input.value.trim() !== "";
                showError(input, valid, message);
            });
        }
    });

    // Email format
    const email = form.querySelector("[name='email']");
    email.addEventListener("input", () => {
        const valid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value.trim());
        showError(email, valid, "Enter a valid email.");
    });

    // Phone format
    const contact = form.querySelector("[name='contact']");
    contact.addEventListener("input", () => {
        const valid = /^\d{10}$/.test(contact.value.trim());
        showError(contact, valid, "Enter a valid 10-digit contact number.");
    });

    function showError(input, isValid, message) {
        let errorEl = input.nextElementSibling;
        if (!errorEl || !errorEl.classList.contains("error-msg")) {
            errorEl = document.createElement("div");
            errorEl.className = "error-msg";
            errorEl.style.color = "red";
            input.parentNode.appendChild(errorEl);
        }
        errorEl.textContent = isValid ? "" : message;
    }
});
</script>

</body>
</html>
 
